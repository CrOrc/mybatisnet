<?xml version="1.0" encoding="UTF-8" ?>

<sqlMap name="Order" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xsi:noNamespaceSchemaLocation="..\..\Nausicaa.Framework.Dal\Schemas\SqlMap.xsd">

	<alias>
		<typeAlias name="Order" assembly="IBatisNet.Test.dll" class="IBatisNet.Test.Domain.Order" />
	</alias>

		<!-- If the type is not specified, ADO.NET infers the 
			  data provider Type of the Parameter from the Value property 
			  of the Parameter object. -->

	<resultMaps>  
	
		<resultMap name="credit-card-result" class="string">
			<result property="value" column="Order_CardNumber"/>
		</resultMap>
  
		<resultMap name="order-with-lines-result" class="Order" 
								extends="lite-order-result-by-name" >
			<result property="LineItemsIList" lazyLoad="true" column="Order_ID" select="GetLineItemsForOrder" />
		</resultMap>
		
		<resultMap name="order-with-lines-collection" class="Order"
								extends="lite-order-result-by-name" >
			<result property="LineItems" column="Order_ID"  select="GetLineItemsForOrderWithListClass" />
		</resultMap>
		
		<resultMap name="order-with-lines-array" class="Order"
								extends="lite-order-result-by-name">
			<result property="LineItemsArray" column="Order_ID" select="GetLineItemsForOrder"/>
		</resultMap>
  
		<resultMap name="lite-order-map-result" class="Hashtable">
			<result property="Id"         column="Order_ID"/>
			<result property="Date"       column="Order_Date"/>
			<result property="CardExpiry" column="Order_CardExpiry"/>
			<result property="CardType"   column="Order_CardType"/>
			<result property="CardNumber" column="Order_CardNumber"/>
			<result property="Street"     column="Order_Street"/>
			<result property="City"       column="Order_City"/>
			<result property="Province"   column="Order_Province"/>
			<result property="PostalCode" column="Order_PostalCode"/>
		</resultMap>
  
		<resultMap name="lite-order-result-by-name" class="Order">
			<result property="Id"         column="Order_ID"/>
			<result property="Date"       column="Order_Date" nullValue="01/01/0001 00:00:00"/>
			<result property="CardExpiry" column="Order_CardExpiry"/>
			<result property="CardType"   column="Order_CardType"/>
			<result property="CardNumber" column="Order_CardNumber"/>
			<result property="Street"     column="Order_Street"/>
			<result property="City"       column="Order_City"/>
			<result property="Province"   column="Order_Province"/>
			<result property="PostalCode" column="Order_PostalCode"/>
		</resultMap>
		
		<resultMap name="order-with-types-result" class="Order">
			<result property="Id"         column="Order_ID"			dbType="Integer"/><!-- Int for SqlClient, Obdc; Integer for Oledb -->
			<result property="Date"       column="Order_Date"		dbType="DateTime "/>
			<result property="CardExpiry" column="Order_CardExpiry" dbType="VarChar"/>
			<result property="CardType"   column="Order_CardType"	dbType="VarChar"/>
			<result property="CardNumber" column="Order_CardNumber" dbType="VarChar"/>
			<result property="Street"     column="Order_Street"		dbType="VarChar"/>
			<result property="City"       column="Order_City"		dbType="VarChar"/>
			<result property="Province"   column="Order_Province"	dbType="VarChar"/>
			<result property="PostalCode" column="Order_PostalCode" dbType="VarChar"/>
		</resultMap>
		
		<resultMap name="lite-order-result-by-index" class="Order">
			<result property="Id"         column="Order_ID"			columnIndex="0"/>
			<result property="Date"       column="Order_Date"		columnIndex="1" />
			<result property="CardExpiry" column="Order_CardExpiry" columnIndex="2"/>
			<result property="CardType"   column="Order_CardType"	columnIndex="3" />
			<result property="CardNumber" column="Order_CardNumber" columnIndex="4" />
			<result property="Street"     column="Order_Street"		columnIndex="5" />
			<result property="City"       column="Order_City"		columnIndex="6" />
			<result property="Province"   column="Order_Province"	columnIndex="7"/>
			<result property="PostalCode" column="Order_PostalCode" columnIndex="8" />
		</resultMap>
		
		<resultMap name="order-with-account-result" class="Order">
			<result property="Id"         column="Order_ID"/>
			<result property="Date"       column="Order_Date"/>
			<result property="CardExpiry" column="Order_CardExpiry"/>
			<result property="CardType"   column="Order_CardType"/>
			<result property="CardNumber" column="Order_CardNumber"/>
			<result property="Street"     column="Order_Street"/>
			<result property="City"       column="Order_City"/>
			<result property="Province"   column="Order_Province"/>
			<result property="PostalCode" column="Order_PostalCode"/>
			<result property="Account"    column="Account_ID" select="GetAccountViaColumnName" />
		</resultMap>
		
		<resultMap name="order-with-collection-result" class="Order">
			<result property="Id"				column="Order_ID"/>
			<result property="Date"				column="Order_Date"/>
			<result property="CardExpiry"		column="Order_CardExpiry"/>
			<result property="CardType"			column="Order_CardType"/>
			<result property="CardNumber"		column="Order_CardNumber"/>
			<result property="Street"			column="Order_Street"/>
			<result property="City"				column="Order_City"/>
			<result property="Province"			column="Order_Province"/>
			<result property="PostalCode"		column="Order_PostalCode"/>
			<result property="LineItemsIList"	column="Order_ID" select="GetLineItemsForOrder" />	
			<result property="LineItems"		column="Order_ID" select="GetLineItemsForOrder" lazyLoad="false" />
		</resultMap>
		
		<resultMap name="order-with-favourite-line-item" class="Order">
			<result property="Id"					column="Order_ID"/>
			<result property="Date"					column="Order_Date"/>
			<result property="CardExpiry"			column="Order_CardExpiry"/>
			<result property="CardType"				column="Order_CardType"/>
			<result property="CardNumber"			column="Order_CardNumber"/>
			<result property="Street"				column="Order_Street"/>
			<result property="City"					column="Order_City"/>
			<result property="Province"				column="Order_Province"/>
			<result property="PostalCode"			column="Order_PostalCode"/>
			<result property="FavouriteLineItem"	column="Order_ID=Order_ID,LineItem_ID=Order_FavouriteLineItem" select="GetSpecificLineItem" />
		</resultMap>
		
		<resultMap name="order-with-dyn-favourite-line-item" class="Order">
			<result property="Id"					column="Order_ID"/>
			<result property="Date"					column="Order_Date"/>
			<result property="CardExpiry"			column="Order_CardExpiry"/>
			<result property="CardType"				column="Order_CardType"/>
			<result property="CardNumber"			column="Order_CardNumber"/>
			<result property="Street"				column="Order_Street"/>
			<result property="City"					column="Order_City"/>
			<result property="Province"				column="Order_Province"/>
			<result property="PostalCode"			column="Order_PostalCode"/>
			<result property="FavouriteLineItem"	
						column="Order_ID=Order_ID,LineItem_ID=Order_FavouriteLineItem" 
						select="GetDynSpecificLineItem" />
		</resultMap>
		
		<resultMap name="order-joined-favourite" class="Order">
			<result property="Id"					column="Order_ID"/>
			<result property="Date"					column="Order_Date"/>
			<result property="CardExpiry"			column="Order_CardExpiry"/>
			<result property="CardType"				column="Order_CardType"/>
			<result property="CardNumber"			column="Order_CardNumber"/>
			<result property="Street"				column="Order_Street"/>
			<result property="City"					column="Order_City"/>
			<result property="Province"				column="Order_Province"/>
			<result property="PostalCode"			column="Order_PostalCode"/>
			<result property="FavouriteLineItem"	resultMapping="LineItem.LineItem" />
		</resultMap>
		
	</resultMaps>  
	
	<statements>
		<statement name="GetOrderLiteByColumnName"
					parameterClass="Int"
					resultMap="lite-order-result-by-name" >
			select * from Orders where Order_ID = #value#
		</statement>
		
		<statement name="GetOrderLiteByColumnIndex"
					parameterClass="Int"
					resultMap="lite-order-result-by-index" >
			select
			Order_ID,
			Order_Date,
			Order_CardExpiry,
			Order_CardType,
			Order_CardNumber,
			Order_Street,
			Order_City,
			Order_Province,
			Order_PostalCode
			from Orders where Order_ID = #value#
		</statement>
		
		<statement name="GetOrderWithTypes"
					parameterClass="Int"
					resultMap="order-with-types-result" >
			select * from Orders where Order_ID = #value#
		</statement>
		
		<statement name="GetOrderWithLineItems"
					parameterClass="Integer"
					resultMap="order-with-lines-result" >
			select * from Orders where Order_ID = #value#
		</statement>


		<statement name="GetOrderCardExpiryViaResultClass"
					parameterClass="int"
					resultClass="date">
			select
			Order_Date
			from Orders where Order_ID = #value#
		</statement>
		
		<statement name="GetOrderWithAccount"
					parameterClass="int"
					resultMap="order-with-account-result" >
			select * from Orders where Order_ID = #value#
		</statement>
		
		<statement name="GetOrderWithLineItemsCollection"
					parameterClass="Integer"
					resultMap="order-with-collection-result" >
			select * from Orders where Order_ID = #value#
		</statement>
		
		 <statement name="GetOrderJoinedFavourite"
                    parameterClass="Integer"
                    resultMap="order-joined-favourite" >
			select * from Orders, LineItems
			where Orders.Order_ID = LineItems.Order_ID
			and Order_FavouriteLineItem = LineItems.LineItem_ID
			and Orders.Order_ID = #value#
		</statement>
		
		<statement name="GetOrderWithFavouriteLineItem"
					parameterClass="int"
					resultMap="order-with-favourite-line-item" >
			select * from Orders where Order_ID = #value#
		</statement>
		
		<statement name="GetOrderWithLineItemCollection"
					parameterClass="int"
					resultMap="order-with-lines-collection" >
			select * from Orders where Order_ID = #value#
		</statement>
		
		<statement name="GetOrderAsHastable"
					parameterClass="Integer"
					resultMap="lite-order-map-result" >
			select * from Orders where Order_ID = #value#
		</statement>
		
		<statement name="GetOrderWithLineItemArray"
				parameterClass="int"
				resultMap="order-with-lines-array">
				select * from Orders where Order_ID = #value#
		</statement>
		
		<statement name="GetAllCreditCardNumbersFromOrders"
				resultMap="credit-card-result" >
			select distinct Order_CardNumber from Orders
			order by Order_CardNumber
		</statement>
		
		<statement name="InsertOrderViaParameterMap"
                    parameterMap="insert-params" >
			insert into Orders  
				(Order_ID, Account_ID, Order_Date, Order_CardExpiry, Order_CardType, 
					Order_CardNumber, Order_Street, Order_City, Order_Province, Order_PostalCode ) 
			values 
				(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
		</statement>		
		
		<select name="GetOrderWithDynFavouriteLineItem"
				parameterClass="Integer"
				resultMap="order-with-dyn-favourite-line-item">
			select * from Orders where Order_ID = #value#
		</select>			
		
	</statements>

	<parameterMaps>   
		
		<parameterMap name="insert-params">
			<parameter property="Id" dbType="Integer"/>	<!-- Int for SqlClient, Obdc; Integer for Oledb -->
			<parameter property="Account.Id"/>
			<parameter property="Date" nullValue="01/01/0001 00:00:00" />
			<parameter property="CardExpiry" />
			<parameter property="CardType" />			
			<parameter property="CardNumber" />
			<parameter property="Street" />
			<parameter property="City" />			
			<parameter property="Province" />
			<parameter property="PostalCode" />
		</parameterMap>
		
	</parameterMaps>

</sqlMap>